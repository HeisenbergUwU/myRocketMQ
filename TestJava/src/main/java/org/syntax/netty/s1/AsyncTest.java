package org.syntax.netty.s1;

import io.netty.bootstrap.ServerBootstrap;
import io.netty.buffer.ByteBuf;
import io.netty.channel.ChannelFuture;
import io.netty.channel.ChannelHandlerContext;
import io.netty.channel.ChannelInboundHandlerAdapter;
import io.netty.channel.ChannelInitializer;
import io.netty.channel.nio.NioEventLoopGroup;
import io.netty.channel.socket.SocketChannel;
import io.netty.channel.socket.nio.NioServerSocketChannel;

import java.nio.charset.Charset;

public class AsyncTest {
    public static void main(String[] args) throws InterruptedException {
        /**
         * 启动ServerBootstrap
         * → 绑定端口
         * → 接受客户端连接
         * → 为每个连接创建Channel
         * → 初始化Pipeline
         * → 处理数据（channelRead）
         * → 连接关闭（channelInactive）
         * → 释放资源
         */
        ChannelFuture bind = new ServerBootstrap() // ServerBootstrap 用来创建服务端； Bootstrap 用来创建客户端
                .group(new NioEventLoopGroup(2))
                .channel(NioServerSocketChannel.class)
                .childHandler(new ChannelInitializer<SocketChannel>() {
                    @Override
                    protected void initChannel(SocketChannel ch) throws Exception {
                        ch.pipeline().addLast(new ChannelInboundHandlerAdapter() {
                            @Override
                            public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {
                                ByteBuf msg1 = (ByteBuf) msg;
                                System.out.println(msg1.toString(Charset.defaultCharset()));
                                super.channelRead(ctx, msg);
                            }
                        });
                    }
                }).bind(8080);

        /**
         * /Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/bin/java -javaagent:/Applications/IntelliJ IDEA CE.app/Contents/lib/idea_rt.jar=59707 -Dfile.encoding=UTF-8 -classpath /Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/charsets.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/cldrdata.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/dnsns.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/jaccess.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/localedata.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/nashorn.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/sunec.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/sunjce_provider.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/sunpkcs11.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/ext/zipfs.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/jce.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/jfr.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/jsse.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/management-agent.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/resources.jar:/Users/qilei/Library/Java/JavaVirtualMachines/corretto-1.8.0_442/Contents/Home/jre/lib/rt.jar:/Users/qilei/Desktop/myRocketMQ/TestJava/target/classes:/Users/qilei/.m2/repository/com/alibaba/fastjson/1.2.83/fastjson-1.2.83.jar:/Users/qilei/.m2/repository/com/alibaba/fastjson2/fastjson2/2.0.51/fastjson2-2.0.51.jar:/Users/qilei/.m2/repository/io/netty/netty-all/4.1.114.Final/netty-all-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-buffer/4.1.114.Final/netty-buffer-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec/4.1.114.Final/netty-codec-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-dns/4.1.114.Final/netty-codec-dns-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-haproxy/4.1.114.Final/netty-codec-haproxy-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-http/4.1.114.Final/netty-codec-http-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-http2/4.1.114.Final/netty-codec-http2-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-memcache/4.1.114.Final/netty-codec-memcache-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-mqtt/4.1.114.Final/netty-codec-mqtt-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-redis/4.1.114.Final/netty-codec-redis-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-smtp/4.1.114.Final/netty-codec-smtp-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-socks/4.1.114.Final/netty-codec-socks-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-stomp/4.1.114.Final/netty-codec-stomp-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-codec-xml/4.1.114.Final/netty-codec-xml-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-common/4.1.114.Final/netty-common-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-handler/4.1.114.Final/netty-handler-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-native-unix-common/4.1.114.Final/netty-transport-native-unix-common-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-handler-proxy/4.1.114.Final/netty-handler-proxy-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-handler-ssl-ocsp/4.1.114.Final/netty-handler-ssl-ocsp-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-resolver/4.1.114.Final/netty-resolver-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-resolver-dns/4.1.114.Final/netty-resolver-dns-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport/4.1.114.Final/netty-transport-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-rxtx/4.1.114.Final/netty-transport-rxtx-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-sctp/4.1.114.Final/netty-transport-sctp-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-udt/4.1.114.Final/netty-transport-udt-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-classes-epoll/4.1.114.Final/netty-transport-classes-epoll-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-classes-kqueue/4.1.114.Final/netty-transport-classes-kqueue-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-resolver-dns-classes-macos/4.1.114.Final/netty-resolver-dns-classes-macos-4.1.114.Final.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-native-epoll/4.1.114.Final/netty-transport-native-epoll-4.1.114.Final-linux-x86_64.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-native-epoll/4.1.114.Final/netty-transport-native-epoll-4.1.114.Final-linux-aarch_64.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-native-epoll/4.1.114.Final/netty-transport-native-epoll-4.1.114.Final-linux-riscv64.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-native-kqueue/4.1.114.Final/netty-transport-native-kqueue-4.1.114.Final-osx-x86_64.jar:/Users/qilei/.m2/repository/io/netty/netty-transport-native-kqueue/4.1.114.Final/netty-transport-native-kqueue-4.1.114.Final-osx-aarch_64.jar:/Users/qilei/.m2/repository/io/netty/netty-resolver-dns-native-macos/4.1.114.Final/netty-resolver-dns-native-macos-4.1.114.Final-osx-x86_64.jar:/Users/qilei/.m2/repository/io/netty/netty-resolver-dns-native-macos/4.1.114.Final/netty-resolver-dns-native-macos-4.1.114.Final-osx-aarch_64.jar:/Users/qilei/.m2/repository/com/github/luben/zstd-jni/1.5.5-11/zstd-jni-1.5.5-11.jar:/Users/qilei/Desktop/myRocketMQ/common/target/classes:/Users/qilei/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/Users/qilei/.m2/repository/commons-validator/commons-validator/1.7/commons-validator-1.7.jar:/Users/qilei/.m2/repository/commons-beanutils/commons-beanutils/1.9.4/commons-beanutils-1.9.4.jar:/Users/qilei/.m2/repository/commons-digester/commons-digester/2.1/commons-digester-2.1.jar:/Users/qilei/.m2/repository/commons-logging/commons-logging/1.2/commons-logging-1.2.jar:/Users/qilei/.m2/repository/commons-collections/commons-collections/3.2.2/commons-collections-3.2.2.jar:/Users/qilei/.m2/repository/org/lz4/lz4-java/1.8.0/lz4-java-1.8.0.jar:/Users/qilei/.m2/repository/com/google/guava/guava/32.0.1-jre/guava-32.0.1-jre.jar:/Users/qilei/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/Users/qilei/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/Users/qilei/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/Users/qilei/.m2/repository/org/checkerframework/checker-qual/3.33.0/checker-qual-3.33.0.jar:/Users/qilei/.m2/repository/com/google/j2objc/j2objc-annotations/2.8/j2objc-annotations-2.8.jar:/Users/qilei/.m2/repository/commons-codec/commons-codec/1.13/commons-codec-1.13.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-otlp/1.29.0/opentelemetry-exporter-otlp-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-sdk-trace/1.29.0/opentelemetry-sdk-trace-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-semconv/1.29.0-alpha/opentelemetry-semconv-1.29.0-alpha.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-sdk-metrics/1.29.0/opentelemetry-sdk-metrics-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-extension-incubator/1.29.0-alpha/opentelemetry-extension-incubator-1.29.0-alpha.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-sdk-logs/1.29.0/opentelemetry-sdk-logs-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-api-events/1.29.0-alpha/opentelemetry-api-events-1.29.0-alpha.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-otlp-common/1.29.0/opentelemetry-exporter-otlp-common-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-common/1.29.0/opentelemetry-exporter-common-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-sender-okhttp/1.29.0/opentelemetry-exporter-sender-okhttp-1.29.0.jar:/Users/qilei/.m2/repository/com/squareup/okhttp3/okhttp/4.11.0/okhttp-4.11.0.jar:/Users/qilei/.m2/repository/com/squareup/okio/okio/3.2.0/okio-3.2.0.jar:/Users/qilei/.m2/repository/org/jetbrains/kotlin/kotlin-stdlib/1.6.20/kotlin-stdlib-1.6.20.jar:/Users/qilei/.m2/repository/org/jetbrains/kotlin/kotlin-stdlib-common/1.6.20/kotlin-stdlib-common-1.6.20.jar:/Users/qilei/.m2/repository/org/jetbrains/annotations/13.0/annotations-13.0.jar:/Users/qilei/.m2/repository/org/jetbrains/kotlin/kotlin-stdlib-jdk8/1.6.20/kotlin-stdlib-jdk8-1.6.20.jar:/Users/qilei/.m2/repository/org/jetbrains/kotlin/kotlin-stdlib-jdk7/1.6.20/kotlin-stdlib-jdk7-1.6.20.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-sdk-extension-autoconfigure-spi/1.29.0/opentelemetry-sdk-extension-autoconfigure-spi-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-prometheus/1.29.0-alpha/opentelemetry-exporter-prometheus-1.29.0-alpha.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-logging/1.29.0/opentelemetry-exporter-logging-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-sdk/1.29.0/opentelemetry-sdk-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-api/1.29.0/opentelemetry-api-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-context/1.29.0/opentelemetry-context-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-sdk-common/1.29.0/opentelemetry-sdk-common-1.29.0.jar:/Users/qilei/.m2/repository/io/opentelemetry/opentelemetry-exporter-logging-otlp/1.29.0/opentelemetry-exporter-logging-otlp-1.29.0.jar:/Users/qilei/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.15.2/jackson-core-2.15.2.jar:/Users/qilei/.m2/repository/io/grpc/grpc-stub/1.53.0/grpc-stub-1.53.0.jar:/Users/qilei/.m2/repository/io/grpc/grpc-api/1.53.0/grpc-api-1.53.0.jar:/Users/qilei/.m2/repository/io/grpc/grpc-context/1.53.0/grpc-context-1.53.0.jar:/Users/qilei/.m2/repository/com/google/errorprone/error_prone_annotations/2.14.0/error_prone_annotations-2.14.0.jar:/Users/qilei/.m2/repository/io/grpc/grpc-netty-shaded/1.53.0/grpc-netty-shaded-1.53.0.jar:/Users/qilei/.m2/repository/io/perfmark/perfmark-api/0.25.0/perfmark-api-0.25.0.jar:/Users/qilei/.m2/repository/io/grpc/grpc-core/1.53.0/grpc-core-1.53.0.jar:/Users/qilei/.m2/repository/com/google/code/gson/gson/2.9.0/gson-2.9.0.jar:/Users/qilei/.m2/repository/com/google/android/annotations/4.1.1.4/annotations-4.1.1.4.jar:/Users/qilei/.m2/repository/org/codehaus/mojo/animal-sniffer-annotations/1.21/animal-sniffer-annotations-1.21.jar:/Users/qilei/.m2/repository/com/squareup/okio/okio-jvm/3.4.0/okio-jvm-3.4.0.jar:/Users/qilei/.m2/repository/org/apache/tomcat/annotations-api/6.0.53/annotations-api-6.0.53.jar:/Users/qilei/.m2/repository/io/github/aliyunmq/rocketmq-slf4j-api/1.0.1/rocketmq-slf4j-api-1.0.1.jar:/Users/qilei/.m2/repository/io/github/aliyunmq/rocketmq-logback-classic/1.0.1/rocketmq-logback-classic-1.0.1.jar:/Users/qilei/.m2/repository/org/apache/rocketmq/rocketmq-rocksdb/1.0.2/rocketmq-rocksdb-1.0.2.jar:/Users/qilei/.m2/repository/org/awaitility/awaitility/4.1.0/awaitility-4.1.0.jar:/Users/qilei/.m2/repository/org/hamcrest/hamcrest/2.1/hamcrest-2.1.jar:/Users/qilei/Desktop/myRocketMQ/remoting/target/classes:/Users/qilei/.m2/repository/org/reflections/reflections/0.9.11/reflections-0.9.11.jar:/Users/qilei/.m2/repository/org/javassist/javassist/3.21.0-GA/javassist-3.21.0-GA.jar org.syntax.netty.s1.AsyncTest
         * false
         * false
         * 启动
         * false
         * false
         * true
         * true
         */
        for (int i = 0; i < 1000000; i++) {
            System.out.println(bind.isSuccess()); // 判断操作是否成功
            System.out.println(bind.isDone()); // 判断操作是否完成 【无论成功还是失败】
        }

        System.out.println("启动");
        System.out.println(bind.isSuccess()); // 判断操作是否成功
        System.out.println(bind.isDone()); // 判断操作是否完成 【无论成功还是失败】
        //
        bind.sync();
        System.out.println(bind.isSuccess()); // 判断操作是否成功
        System.out.println(bind.isDone()); // 判断操作是否完成 【无论成功还是失败】
    }
}
